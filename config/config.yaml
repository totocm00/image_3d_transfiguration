# ============================================================
# image_3d_transfiguration v3 메인 설정 파일 (정리 버전)
# 백엔드 구조:
#   - sam3d     : sam-3d 백엔드 직접 호출
#   - depth_anything / zoe_depth : 기존 파이프라인
# ============================================================


# ------------------------------------------------------------
# 1. DEPTH / 백엔드 엔진 설정
# ------------------------------------------------------------
depth:
  # 백엔드 선택
  # - "sam3d"         : sam-3d inference를 직접 호출 (추천, 최고 품질)
  # - "depth_anything": DepthAnything 기반 (기존 파이프라인)
  # - "zoe_depth"     : ZoeDepth 기반
  
  # backend_primary: "depth_anything"
  backend_primary : "sam3d"

  # 보조 depth 백엔드 (""이면 사용 안 함)
  backend_secondary: ""

  # sam-3d 백엔드 전용 설정
  sam3d_root: "/home/toto/parent/sam-3d-objects"
  sam3d_python: "python"

  # primary + secondary 결과 합성 비율
  fusion_alpha: 0.7

  # depth 출력 해상도 모드
  # - "original" : 원본 이미지 해상도 유지
  # - "downscale": downscale → upsample (속도/메모리 절약)
  resolution_mode: "original"

  # resolution_mode == "downscale" 일 때만 사용
  downscale_ratio: 0.5



# ------------------------------------------------------------
# 2. INPUT 설정
# ------------------------------------------------------------
input:
  # 마스크 사용 여부
  use_mask: false

  # 마스크 모드
  # - "full"   : 전체 이미지
  # - "auto"   : SAM/YOLO 자동 세그멘테이션
  # - "manual" : 사용자가 마스크 제공
  mask_mode: "full"



# ------------------------------------------------------------
# 3. PATHS 설정 (입출력 디렉토리)
# ------------------------------------------------------------
paths:
  image_dir: "assets/images"
  output_root: "assets/outputs"

  # output_root 아래 폴더
  depth_dir: "depth"
  pointcloud_dir: "pointcloud"
  mesh_dir: "mesh"
  preview_dir: "preview"



# ------------------------------------------------------------
# 4. DEPTH FUSION 설정
# ------------------------------------------------------------
fusion:
  enabled: false

  # 방법: mean | weighted | min | max
  method: "mean"

  # weighted 모드일 때 primary depth 비중
  primary_weight: 0.7



# ------------------------------------------------------------
# 5. OUTPUT 저장 옵션
# ------------------------------------------------------------
output:
  save_depth_png: true
  depth_grayscale: true

  save_pointcloud: true
  save_mesh: true

  # 픽셀 샘플링 간격
  point_step: 2

  # depth 정규화 클리핑
  clip_min: 0.05
  clip_max: 0.95

  postprocess:
    voxel_size: 0.015
    remove_statistical_outlier: true
    nb_neighbors: 20
    std_ratio: 2.0



# ------------------------------------------------------------
# 6. MESH 생성 옵션
# ------------------------------------------------------------
mesh:
  method: "poisson"            # poisson | ball_pivoting
  smoothing_iterations: 5
  target_reduction: 0.5        # 0.0 ~ 1.0
  export_format: "ply"         # ply | obj | glb



# ------------------------------------------------------------
# 7. TEXTURE 생성 옵션
# ------------------------------------------------------------
texture:
  enabled: true
  scale: 1.0                   # 1.0 = 원본 해상도



# ------------------------------------------------------------
# 8. VIEWER 설정
# ------------------------------------------------------------
viewer:
  default_mode: "mesh"         # pointcloud | mesh
  background_color: [0.0, 0.0, 0.0]
  point_size: 2.0
  line_width: 1.0



# ------------------------------------------------------------
# 9. SYSTEM 설정
# ------------------------------------------------------------
system:
  device: "auto"               # auto | cuda | cpu
  random_seed: 42
  log_level: "INFO"