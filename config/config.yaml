# ============================================================
# image_3d_transfiguration v2 메인 설정 파일
# - 이 파일 하나로 엔진의 동작 방식을 대부분 제어합니다.
# - 주석 읽으면서 필요한 부분만 숫자/옵션을 바꿔 쓰면 됩니다.
# ============================================================

paths:
  # 입력 이미지를 불러올 기본 디렉토리
  # 예: assets/images/robot.png 라면 image_dir = "assets/images"
  image_dir: "assets/images"

  # 출력 파일들이 저장될 루트 경로
  output_root: "assets/outputs"

  # 하위 폴더명 (output_root 아래에 생성)
  depth_dir: "depth"         # depth PNG 저장 폴더
  pointcloud_dir: "pointcloud" # point cloud .ply 저장 폴더
  mesh_dir: "mesh"           # mesh .ply/.obj/.glb 저장 폴더
  preview_dir: "preview"     # 미리보기 이미지/썸네일 저장 폴더

input:
  # 마스크 사용 여부
  # - true  : mask 모듈 사용 (향후 SAM/YOLO 연동 포인트)
  # - false : 전체 이미지를 그대로 사용 (기본값)
  use_mask: false

  # 마스크 모드
  # - "full"     : 전체 이미지 마스크 (mask 모듈에서 기본 제공)
  # - "auto"     : 자동 세그멘테이션 (SAM/YOLO 연결 후 사용 예정)
  # - "manual"   : 사용자가 별도 마스크 이미지를 제공하는 모드
  mask_mode: "full"

depth:
  # depth 백엔드 선택
  # - "depth_anything" : Depth Anything 기반 (추천, 고품질)
  # - "zoe_depth"      : ZoeDepth 기반 (옵션)
  # - "fake"           : 개발/테스트용 더미 백엔드 (실제 프로젝트에서는 비권장)
  backend_primary: "depth_anything"

  # 세컨더리 depth 백엔드 (선택사항, ""면 사용 안 함)
  # - primary와 secondary 두 개를 함께 써서 fusion 가능
  backend_secondary: ""

  # Depth 출력 해상도 모드
  # - "original" : 원본 이미지 해상도 유지
  # - "downscale": 내부에서 downscale 후 다시 upsample (속도/메모리 절약)
  resolution_mode: "original"

  # downscale 비율 (resolution_mode가 "downscale"일 때만 사용)
  # 예: 0.5면 가로/세로를 절반 해상도로 줄여서 예측
  downscale_ratio: 0.5

fusion:
  # depth 두 개를 fusion 할지 여부
  # - true  : primary + secondary 둘 다 사용해서 합성
  # - false : primary 하나만 사용
  enabled: false

  # fusion 방법
  # - "mean"        : 단순 평균
  # - "weighted"    : 가중 평균 (primary_weight 참고)
  # - "min"         : 픽셀별 최소값 (보수적으로 가까운 쪽 선택)
  # - "max"         : 픽셀별 최대값
  method: "mean"

  # weighted 모드일 때 primary depth에 줄 가중치 (0.0 ~ 1.0)
  primary_weight: 0.7

output:
  # depth PNG 저장 여부
  save_depth_png: true

  # depth PNG를 0~255 그레이스케일로 저장할지 여부
  depth_grayscale: true

  # point cloud 저장 여부
  save_pointcloud: true

  # mesh 생성 및 저장 여부
  save_mesh: true

  # point cloud 생성 시, 픽셀 샘플링 간격
  # - 1 : 모든 픽셀 사용 (품질↑ / 용량,시간↑)
  # - 2~4 : 품질과 속도 사이 타협
  point_step: 2

  # depth 값 정규화 시 앞/뒤 구간 클리핑 비율 (0.0 ~ 1.0)
  # - 노이즈 제거용, extreme depth 값 잘라냄
  clip_min: 0.05
  clip_max: 0.95

  # point cloud 후처리 옵션
  postprocess:
    # voxel 다운샘플링 (0.0이면 비활성화)
    # - 예: 0.01 ~ 0.02 정도를 시작점으로 사용
    voxel_size: 0.015

    # 통계 기반 outlier 제거 사용 여부
    remove_statistical_outlier: true

    # outlier 제거 설정
    nb_neighbors: 20    # 이웃 포인트 개수
    std_ratio: 2.0      # 표준편차 기준 (값이 작을수록 더 많이 제거)

mesh:
  # 메쉬 생성 알고리즘 선택
  # - "poisson" : 부드러운 표면, 일반 용도 (기본)
  # - "ball_pivoting" : 날카로운 edge 유지, 공업용 선호
  method: "poisson"

  # 메쉬 후처리 옵션
  smoothing_iterations: 5   # Laplacian smoothing 반복 횟수
  target_reduction: 0.5     # 단순화 비율 (0.0 ~ 1.0, 0.5면 삼각형 개수 절반으로)

  # 메쉬를 어떤 포맷으로 export할지
  # - "ply"  : 기본, Open3D 친화적
  # - "obj"  : 텍스처 이미지와 함께 내보내기 좋음
  # - "glb"  : 웹/게임/디지털트윈 엔진용 (gltf binary)
  export_format: "ply"

texture:
  # 텍스처 생성 여부
  enabled: true

  # 텍스처 해상도 스케일
  # - 1.0 : 원본 이미지 해상도 활용
  # - 0.5 : 절반 해상도로 텍스처 축소
  scale: 1.0

viewer:
  # run_viewer.py 기본 설정
  # - "pointcloud" : point cloud 우선
  # - "mesh"       : mesh 우선
  default_mode: "mesh"

  # Open3D 배경 색상 (0.0 ~ 1.0 범위의 RGB)
  background_color: [0.0, 0.0, 0.0]

  # 포인트 크기 / 라인 굵기 조절용
  point_size: 2.0
  line_width: 1.0

system:
  # 디바이스 설정
  # - "auto": GPU 있으면 cuda, 없으면 cpu 자동 선택
  # - "cuda": GPU 강제 사용
  # - "cpu" : CPU 강제 사용
  device: "auto"

  # 랜덤 시드 (재현성 필요할 때 사용)
  random_seed: 42

  # 로깅 레벨
  # - "DEBUG", "INFO", "WARNING", "ERROR"
  log_level: "INFO"
